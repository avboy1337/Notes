<!-- TOC -->

- [1. 提权](#1-提权)
- [2. 隐藏自身](#2-隐藏自身)
- [3. 隐藏启动](#3-隐藏启动)
- [4. 数据加密](#4-数据加密)
    - [4.1. 简单加密算法](#41-简单加密算法)
        - [4.1.1. 优点](#411-优点)
        - [4.1.2. 形式](#412-形式)
    - [4.2. Base64编码](#42-base64编码)
    - [4.3. 复杂加密算法](#43-复杂加密算法)
        - [4.3.1. 识别复杂加密算法](#431-识别复杂加密算法)
        - [4.3.2. 识别复杂加密算法的插件](#432-识别复杂加密算法的插件)
            - [4.3.2.1. RC4和IDEA](#4321-rc4和idea)
        - [4.3.3. 识别自定义加密](#433-识别自定义加密)
- [5. 网络行为](#5-网络行为)
    - [5.1. 网络元素](#51-网络元素)
    - [5.2. 获取途径](#52-获取途径)
    - [5.3. OPSEC（操作安全性）](#53-opsec操作安全性)
    - [5.4. 网络检测与告警](#54-网络检测与告警)
        - [5.4.1. 选取方案](#541-选取方案)
        - [5.4.2. 检测工具](#542-检测工具)
- [6. 下载器](#6-下载器)
- [7. 启动器](#7-启动器)
- [8. 后门（反弹shell、远控、僵尸网络）](#8-后门反弹shell远控僵尸网络)
    - [8.1. 远控和僵尸网络的区别](#81-远控和僵尸网络的区别)
- [9. 窃取登录凭证](#9-窃取登录凭证)
- [10. 键盘记录器](#10-键盘记录器)

<!-- /TOC -->
# 1. 提权
* 0day和nday漏洞
* DLL加载顺序劫持，可以获取加载DLL的进程的权限
* SeDebugPrivilege
# 2. 隐藏自身
* 将实际行为代码加密后存放在资源节或者数据节
* 进程注入
* Detours（拓展二进制文件库）
* APC注入（异步过程调用注入），见《恶意代码分析实战》P243-245
# 3. 隐藏启动
* 内存注入
* PE感染
# 4. 数据加密
目的：获取网络通信及内部工作原理，包括配置信息、窃取的数据和字符串
## 4.1. 简单加密算法
### 4.1.1. 优点
体积小、开销低、没有复杂加密算法的通用特征
### 4.1.2. 形式
移位、异或（单、多字节）、保留NULL和异或字节本身的异或
## 4.2. Base64编码
Base64可以指定字符集来编码，这样会获取完全不同的结果
## 4.3. 复杂加密算法
### 4.3.1. 识别复杂加密算法
* 加密相关库和导入函数
* 密钥
* 加密相关字符串
* 计算文件各个部分的熵值（混乱程度）来找到被加密的部分（会误报图片、音频和压缩数据）
### 4.3.2. 识别复杂加密算法的插件
* IDA-FindCrypt2、3
* IDA-idaentropy-plugin
* Peid-Krypto ANALyzer(识别能力更强，更容易误报)
#### 4.3.2.1. RC4和IDEA
这两种算法不使用神秘常量，RC4体积小易实现，所以难以识别
### 4.3.3. 识别自定义加密
寻找输入输出，分离加解密函数，编写函数（Python的PyCrypto库）或者调用恶意代码中存在的函数来解密。对于需要从外部环境（如文件、网络）获取加密元素的情况下，需要对外部环境进行模拟。
# 5. 网络行为
## 5.1. 网络元素
* IP地址
* 端口
* 域名
* 流量内容
## 5.2. 获取途径
* 原始信息如字符串
* 搜索引擎
## 5.3. OPSEC（操作安全性）
对网络行为进行调查时，要注意不能让对方发现自己在进行调查。
* 搜索引擎搜索未收录域名时，可能会触发搜索引擎对域名的爬虫工作
* 单机搜索引擎结果，可能会导致二级域名和后续链接被激活
## 5.4. 网络检测与告警
### 5.4.1. 选取方案
* IP地址、端口、域名：时效性差，容易编写规则
* 内容：时效性好，规则编写难度较高
### 5.4.2. 检测工具
* Snort规则
* Yara规则
# 6. 下载器
# 7. 启动器
# 8. 后门（反弹shell、远控、僵尸网络）
* 远控可发动旁路劫持攻击
## 8.1. 远控和僵尸网络的区别
* 远控：量小、进行针对性攻击
* 僵尸网络：量大、操作行为相同、进行大规模攻击
# 9. 窃取登录凭证
* 转储Windows口令哈希来离线破解或者发动Pass-the-hash攻击
* GINA即第三方自定义登录方式拦截
# 10. 键盘记录器
* 消息Hook
* 内核Rootkit捕获
* 按键状态轮询：使用函数GetAsyncKeyState判断一个按键是按下或者弹起，使用GetForegroundWindow识别当前聚焦的前端窗口